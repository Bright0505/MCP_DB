# v4.2 æ¶æ§‹é‡æ§‹æ–‡æª”

## ğŸ“‹ æ¦‚è¿°

v4.2 ç‰ˆæœ¬é€²è¡Œäº†å…¨é¢çš„æ¶æ§‹é‡æ§‹ï¼Œå°‡åŸæœ¬æ··äº‚çš„å–®é«”ä»£ç¢¼é‡æ§‹ç‚ºæ¸…æ™°çš„åˆ†å±¤æ¶æ§‹ã€‚æœ¬æ¬¡é‡æ§‹éµå¾ªé—œæ³¨é»åˆ†é›¢åŸå‰‡ï¼Œæé«˜äº†ä»£ç¢¼çš„å¯ç¶­è­·æ€§ã€å¯æ¸¬è©¦æ€§å’Œå¯æ“´å±•æ€§ã€‚

## ğŸ—ï¸ æ–°çš„ç›®éŒ„çµæ§‹

```
src/
â”œâ”€â”€ core/                      # æ ¸å¿ƒå±¤
â”‚   â”œâ”€â”€ __init__.py
â”‚   â”œâ”€â”€ config.py             # é…ç½®ç®¡ç†ï¼ˆDatabaseConfig, AppConfig, SchemaConfigï¼‰
â”‚   â”œâ”€â”€ dependencies.py        # ä¾è³´æ³¨å…¥ï¼ˆå–®ä¾‹æ¨¡å¼ï¼‰
â”‚   â”œâ”€â”€ exceptions.py          # è‡ªå®šç¾©ç•°å¸¸
â”‚   â””â”€â”€ error_handling.py      # çµ±ä¸€éŒ¯èª¤è™•ç†
â”‚
â”œâ”€â”€ database/                  # æ•¸æ“šåº«å±¤
â”‚   â”œâ”€â”€ __init__.py
â”‚   â”œâ”€â”€ manager.py            # DatabaseManagerï¼ˆé€£æ¥å’Œæ“ä½œç®¡ç†ï¼‰
â”‚   â”œâ”€â”€ connectors.py         # æ•¸æ“šåº«é€£æ¥å™¨ï¼ˆMSSQL, PostgreSQLï¼‰
â”‚   â””â”€â”€ schema/               # Schema å­ç³»çµ±
â”‚       â”œâ”€â”€ __init__.py
â”‚       â”œâ”€â”€ cache.py          # SchemaCacheï¼ˆå¿«å–å’Œé è¼‰ï¼‰
â”‚       â”œâ”€â”€ introspector.py   # SchemaIntrospectorï¼ˆè³‡æ–™åº«å…§çœï¼‰
â”‚       â”œâ”€â”€ formatter.py      # Schema æ ¼å¼åŒ–å™¨
â”‚       â””â”€â”€ static_loader.py  # éœæ…‹ Schema è¼‰å…¥å™¨ï¼ˆJSONé…ç½®ï¼‰
â”‚
â”œâ”€â”€ tools/                     # å·¥å…·å±¤
â”‚   â”œâ”€â”€ __init__.py
â”‚   â”œâ”€â”€ registry.py           # å·¥å…·è¨»å†Šä¸­å¿ƒï¼ˆget_all_toolsï¼‰
â”‚   â””â”€â”€ handlers.py           # å·¥å…·è™•ç†å™¨ï¼ˆhandle_tool_callï¼‰
â”‚
â”œâ”€â”€ mcp/                       # MCP å”è­°å±¤
â”‚   â”œâ”€â”€ __init__.py
â”‚   â”œâ”€â”€ base_server.py        # BaseMCPServerï¼ˆå‚³è¼¸ç„¡é—œï¼‰
â”‚   â”œâ”€â”€ stdio_server.py       # StdioMCPServerï¼ˆSTDIO å‚³è¼¸ï¼‰
â”‚   â””â”€â”€ sse_server.py         # SseMCPServerï¼ˆHTTP/SSE å‚³è¼¸ï¼‰
â”‚
â”œâ”€â”€ api/                       # REST API å±¤
â”‚   â”œâ”€â”€ __init__.py
â”‚   â”œâ”€â”€ routes.py             # FastAPI è·¯ç”±
â”‚   â””â”€â”€ middleware.py         # ä¸­é–“ä»¶é…ç½®ï¼ˆCORSç­‰ï¼‰
â”‚
â”œâ”€â”€ main.py                    # çµ±ä¸€å…¥å£é»ï¼ˆSTDIO/HTTPé›™æ¨¡å¼ï¼‰
â”‚
â””â”€â”€ [èˆŠæ–‡ä»¶ä¿ç•™å‘å¾Œå…¼å®¹]
    â”œâ”€â”€ server.py              # å‘å¾Œå…¼å®¹åŒ…è£å™¨
    â””â”€â”€ http_server.py         # å‘å¾Œå…¼å®¹åŒ…è£å™¨
```

## ğŸ¯ åˆ†å±¤æ¶æ§‹èªªæ˜

### 1. æ ¸å¿ƒå±¤ (core/)

**è·è²¬**: æä¾›è·¨å±¤ä½¿ç”¨çš„æ ¸å¿ƒåŠŸèƒ½

**æ ¸å¿ƒçµ„ä»¶**:

#### config.py
- `DatabaseConfig`: æ•¸æ“šåº«é€£æ¥é…ç½®ï¼ˆæ”¯æ´ MSSQL å’Œ PostgreSQLï¼‰
- `SchemaConfig`: Schema å¿«å–å’Œé è¼‰é…ç½®
- `ClaudeConfig`: Claude API é…ç½®ï¼ˆå¯é¸ï¼‰
- `AppConfig`: æ‡‰ç”¨ç¨‹å¼ç¸½é…ç½®

#### dependencies.py
- å–®ä¾‹æ¨¡å¼çš„é…ç½®ç®¡ç†å™¨
- å–®ä¾‹æ¨¡å¼çš„æ•¸æ“šåº«ç®¡ç†å™¨
- çµ±ä¸€çš„ä¾è³´æ³¨å…¥æ¥å£

#### exceptions.py
- `MCPPOSDBError`: åŸºç¤ç•°å¸¸é¡
- `ToolExecutionError`: å·¥å…·åŸ·è¡ŒéŒ¯èª¤
- `SchemaLoadError`: Schema è¼‰å…¥éŒ¯èª¤
- `DatabaseConnectionError`: æ•¸æ“šåº«é€£æ¥éŒ¯èª¤

#### error_handling.py
- `format_error_response()`: æ ¼å¼åŒ–éŒ¯èª¤éŸ¿æ‡‰ï¼ˆæ”¯æ´ REST å’Œ MCP æ ¼å¼ï¼‰
- `format_success_response()`: æ ¼å¼åŒ–æˆåŠŸéŸ¿æ‡‰
- `safe_execute()`: å®‰å…¨åŸ·è¡ŒåŒ…è£å™¨ï¼ˆåŒæ­¥ï¼‰
- `safe_execute_async()`: å®‰å…¨åŸ·è¡ŒåŒ…è£å™¨ï¼ˆç•°æ­¥ï¼‰
- `ErrorFormat` æšèˆ‰ï¼šREST_API å’Œ MCP_TOOL æ ¼å¼

### 2. æ•¸æ“šåº«å±¤ (database/)

**è·è²¬**: ç®¡ç†æ‰€æœ‰æ•¸æ“šåº«ç›¸é—œæ“ä½œ

**æ ¸å¿ƒçµ„ä»¶**:

#### manager.py - DatabaseManager
- æ•¸æ“šåº«é€£æ¥ç®¡ç†
- Schema æ“ä½œå…¥å£
- æŸ¥è©¢åŸ·è¡Œå’Œå‘½ä»¤åŸ·è¡Œ
- å¿«å–ç®¡ç†

**ä¸»è¦æ–¹æ³•**:
```python
def __init__(config: DatabaseConfig, app_config: AppConfig)
def get_connection()  # é€£æ¥ä¸Šä¸‹æ–‡ç®¡ç†å™¨
def test_connection(include_sensitive_info: Optional[bool] = None)
def execute_query(query: str, params: Optional[List[Any]] = None)
def execute_command(command: str, params: Optional[List[Any]] = None)
def get_schema_info(table_name: Optional[str] = None)
def get_table_dependencies(table_name: str)
def get_schema_summary()
def invalidate_schema_cache(table_name: Optional[str] = None)
```

#### connectors.py
- `create_database_connector()`: å·¥å» å‡½æ•¸
- `MSSQLConnector`: SQL Server é€£æ¥å™¨
- `PostgreSQLConnector`: PostgreSQL é€£æ¥å™¨

#### schema/cache.py - SchemaCache
**æ–°å¢é è¼‰è¿½è¹¤åŠŸèƒ½**:
```python
# é è¼‰ç‹€æ…‹è¿½è¹¤
preload_status: Dict[str, Dict[str, Any]] = {
    "static_preload_completed": False,
    "dynamic_preload_completed": False,
    "static_tables": set(),
    "dynamic_tables": set(),
    "preload_timestamp": None
}

# æ–°å¢æ–¹æ³•
def mark_static_preload_complete(table_names: List[str])
def mark_dynamic_preload_complete(table_names: List[str])
def get_preload_status() -> Dict[str, Any]
def is_table_preloaded(table_name: str) -> Dict[str, bool]
```

#### schema/cache.py - CachedSchemaIntrospector
**æ–°å¢ä¾†æºè¿½è¹¤**:
```python
# æ‰€æœ‰éŸ¿æ‡‰ç¾åœ¨åŒ…å« cache_source å­—æ®µ
{
    "success": True,
    "data": {...},
    "cache_source": "dynamic_cache" | "static_cache" | "database_query" | "denied"
}
```

#### schema/static_loader.py
**ç™½åå–®é©—è­‰**:
```python
# _try_preload_static_schemas() ç¾åœ¨é©—è­‰ç™½åå–®
validated_tables = []  # å­˜åœ¨æ–¼è³‡æ–™åº«çš„è¡¨æ ¼
missing_tables = []     # ä¸å­˜åœ¨çš„è¡¨æ ¼

# æ¯å€‹ schema åŒ…å«é©—è­‰ç‹€æ…‹
{
    "database_validated": True | False
}
```

### 3. å·¥å…·å±¤ (tools/)

**è·è²¬**: MCP å·¥å…·å®šç¾©å’Œè™•ç†é‚è¼¯

**æ ¸å¿ƒçµ„ä»¶**:

#### registry.py
```python
def get_all_tools() -> List[Tool]
    # è¿”å›æ‰€æœ‰å¯ç”¨çš„ MCP å·¥å…·ï¼ˆå¾ server.py é‡æ–°å°å‡ºï¼‰

def get_tool_by_name(name: str) -> Tool
    # æ ¹æ“šåç¨±ç²å–ç‰¹å®šå·¥å…·

def get_tool_names() -> List[str]
    # ç²å–æ‰€æœ‰å·¥å…·åç¨±åˆ—è¡¨
```

#### handlers.py
```python
async def handle_tool_call(
    request: CallToolRequest,
    db_manager: Optional[DatabaseManager] = None
) -> dict:
    # çµ±ä¸€çš„å·¥å…·è™•ç†å…¥å£ï¼ˆå¾ server.py é‡æ–°å°å‡ºï¼‰
```

### 4. MCP å”è­°å±¤ (mcp/)

**è·è²¬**: MCP å”è­°å¯¦ç¾ï¼ˆå‚³è¼¸ç„¡é—œï¼‰

**æ ¸å¿ƒçµ„ä»¶**:

#### base_server.py - BaseMCPServer
```python
class BaseMCPServer:
    """å‚³è¼¸ç„¡é—œçš„ MCP æœå‹™å™¨åŸºç¤å¯¦ç¾"""

    def __init__(db_manager: DatabaseManager, server_name: str)
    def _setup_handlers()  # è¨­ç½® MCP å”è­°è™•ç†å™¨
        # @server.list_tools()
        # @server.call_tool()
        # @server.list_prompts()
        # @server.list_resources()
```

#### stdio_server.py - StdioMCPServer
```python
class StdioMCPServer(BaseMCPServer):
    """STDIO å‚³è¼¸çš„ MCP æœå‹™å™¨"""

    async def run()
        # ä½¿ç”¨ stdio_server() ä¸Šä¸‹æ–‡ç®¡ç†å™¨
```

#### sse_server.py - SseMCPServer
```python
class SseMCPServer(BaseMCPServer):
    """HTTP/SSE å‚³è¼¸çš„ MCP æœå‹™å™¨"""

    def create_asgi_app(allowed_origins: Optional[List[str]] = None)
        # å‰µå»ºå¸¶æœ‰ CORS æ”¯æŒçš„ ASGI æ‡‰ç”¨
        # è™•ç† OPTIONS é æª¢è«‹æ±‚
        # æ³¨å…¥ CORS headers

    async def handle_sse_connection(scope, receive, send)
    async def handle_messages(scope, receive, send)
    def _handle_cors_preflight(scope, receive, send, allowed_origins)
```

### 5. API å±¤ (api/)

**è·è²¬**: REST API ç«¯é»å’Œä¸­é–“ä»¶

**æ ¸å¿ƒçµ„ä»¶**:

#### routes.py
```python
router = APIRouter(prefix="/api/v1")

@router.get("/health")
@router.get("/tools")  # ä½¿ç”¨ tools.get_all_tools()
@router.get("/schema")
@router.post("/query")
@router.post("/execute")
@router.post("/cache/invalidate")
```

#### middleware.py
```python
def setup_middleware(app: FastAPI, config: AppConfig)
    # é…ç½® CORS
    # æœªä¾†ï¼šæ—¥èªŒã€é™æµã€èªè­‰ç­‰
```

## ğŸ”„ çµ±ä¸€å…¥å£é» (main.py)

```python
async def run_stdio_mode():
    """STDIO æ¨¡å¼ï¼ˆç”¨æ–¼ MCP å®¢æˆ¶ç«¯ï¼‰"""
    db_manager = DatabaseManager.create_with_preload()
    from mcp.stdio_server import run_stdio_server
    await run_stdio_server()

async def run_http_mode(host: str, port: int):
    """HTTP æ¨¡å¼ï¼ˆREST API + SSE MCPï¼‰"""
    # å‰µå»º FastAPI æ‡‰ç”¨
    # è¨­ç½®ä¸­é–“ä»¶
    # è¨»å†Š REST API è·¯ç”±
    # æ›è¼‰ SSE MCP ç«¯é»
    # æ·»åŠ å„ªé›…é—œé–‰è™•ç†å™¨
    await server.serve()

def main():
    """ä¸»å…¥å£é»ï¼Œæ”¯æ´åƒæ•¸è§£æ"""
    if args.http:
        asyncio.run(run_http_mode(host, port))
    else:
        asyncio.run(run_stdio_mode())
```

## ğŸ› ä¸»è¦ä¿®å¾©

### 1. Strict Mode é‚è¼¯ (Task 3.2)

**å•é¡Œ**: ç„¡æ³•å€åˆ†ã€Œå¿«å–æœªé è¼‰ã€vsã€Œè¡¨æ ¼ä¸å­˜åœ¨ã€

**è§£æ±ºæ–¹æ¡ˆ**:
```python
# æ‰€æœ‰ schema æŸ¥è©¢ç¾åœ¨åŒ…å«ä¾†æºæ¨™è¨˜
{
    "success": True,
    "data": {...},
    "cache_source": "static_cache",  # æ˜ç¢ºæ¨™è¨˜ä¾†æº
    "database_validated": True
}

# Strict Mode éŒ¯èª¤è¨Šæ¯æ”¹é€²
{
    "success": False,
    "error": "Schema access denied (Strict Mode): Table 'FOO' not found in preloaded configuration",
    "strict_mode": True,
    "cache_source": "denied",
    "hint": "Only pre-configured tables in schemas_config/ are accessible in strict mode"
}
```

### 2. é è¼‰é‚è¼¯åŒæ­¥ (Task 3.7)

**å•é¡Œ**: éœæ…‹å’Œå‹•æ…‹é è¼‰ç¨ç«‹åŸ·è¡Œï¼Œç‹€æ…‹ä¸é€æ˜

**è§£æ±ºæ–¹æ¡ˆ**:
```python
# SchemaCache ç¾åœ¨è¿½è¹¤é è¼‰ç‹€æ…‹
cache.mark_static_preload_complete(["TABLE1", "TABLE2"])
cache.mark_dynamic_preload_complete(["TABLE3", "TABLE4"])

# æŸ¥è©¢é è¼‰ç‹€æ…‹
status = cache.get_preload_status()
# {
#     "static_preload_completed": True,
#     "dynamic_preload_completed": True,
#     "static_tables_count": 2,
#     "dynamic_tables_count": 2,
#     "total_tables": 4,
#     "preload_timestamp": "2025-12-10T10:30:00",
#     "cache_size": 50
# }

# æª¢æŸ¥ç‰¹å®šè¡¨æ ¼
is_loaded = cache.is_table_preloaded("TABLE1")
# {
#     "in_static": True,
#     "in_dynamic": False,
#     "preloaded": True
# }
```

### 3. ç™½åå–®é©—è­‰ (Task 3.8)

**å•é¡Œ**: JSON é…ç½®çš„ç™½åå–®è¡¨æ ¼æœªé©—è­‰æ˜¯å¦çœŸå¯¦å­˜åœ¨

**è§£æ±ºæ–¹æ¡ˆ**:
```python
# å•Ÿå‹•æ™‚é©—è­‰ç™½åå–®
for table in whitelist_tables:
    db_schema = introspector.get_schema_info(table_name)
    if db_schema.get("success"):
        validated_tables.append(table_name)
    else:
        missing_tables.append(table_name)
        logger.warning(f"âš ï¸  Whitelist table '{table_name}' not found in database")

# Schema summary åŒ…å«é©—è­‰ä¿¡æ¯
{
    "summary": [...],
    "validated_tables": ["TABLE1", "TABLE2"],
    "missing_tables": ["TABLE3"]
}
```

### 4. CORS æ”¯æŒ (Task 3.1)

**å•é¡Œ**: æ›è¼‰çš„ SSE å­æ‡‰ç”¨ä¸ç¹¼æ‰¿ FastAPI çš„ CORS ä¸­é–“ä»¶

**è§£æ±ºæ–¹æ¡ˆ**:
```python
# SseMCPServer.create_asgi_app() å…§éƒ¨è™•ç† CORS
async def app(scope, receive, send):
    # è™•ç† OPTIONS é æª¢
    if method == "OPTIONS":
        await self._handle_cors_preflight(...)

    # åŒ…è£ send æ³¨å…¥ CORS headers
    async def cors_send(message):
        if message['type'] == 'http.response.start':
            headers = list(message.get('headers', []))
            origin = self._get_origin_from_scope(scope)
            if origin and origin in allowed_origins:
                headers.append((b'access-control-allow-origin', origin.encode()))
                headers.append((b'access-control-allow-credentials', b'true'))
            message['headers'] = headers
        await original_send(message)
```

### 5. çµ±ä¸€éŒ¯èª¤è™•ç† (Task 3.9)

**å•é¡Œ**: REST API å’Œ MCP å·¥å…·ä½¿ç”¨ä¸åŒçš„éŒ¯èª¤æ ¼å¼

**è§£æ±ºæ–¹æ¡ˆ**:
```python
# core/error_handling.py
from core.error_handling import format_error_response, ErrorFormat

# REST API æ ¼å¼
response = format_error_response(
    error=exc,
    format_type=ErrorFormat.REST_API,
    include_stacktrace=True
)
# {
#     "success": False,
#     "error": "Table not found",
#     "error_type": "TableNotFoundError",
#     "stacktrace": "..."
# }

# MCP å·¥å…·æ ¼å¼
response = format_error_response(
    error=exc,
    format_type=ErrorFormat.MCP_TOOL
)
# {
#     "content": [{
#         "type": "text",
#         "text": "Error: Table not found"
#     }],
#     "isError": True
# }
```

## ğŸ¯ è¨­è¨ˆåŸå‰‡

### 1. é—œæ³¨é»åˆ†é›¢ (Separation of Concerns)
- æ¯å€‹å±¤æ¬¡æœ‰æ˜ç¢ºçš„è·è²¬é‚Šç•Œ
- é¿å…è·¨å±¤ç›´æ¥ä¾è³´

### 2. ä¾è³´æ³¨å…¥ (Dependency Injection)
- ä½¿ç”¨å–®ä¾‹æ¨¡å¼ç®¡ç†é…ç½®å’Œç®¡ç†å™¨
- é€šéæ§‹é€ å‡½æ•¸æ³¨å…¥ä¾è³´

### 3. å‘å¾Œå…¼å®¹ (Backward Compatibility)
- ä¿ç•™ `server.py` å’Œ `http_server.py` ä½œç‚ºåŒ…è£å™¨
- ç¾æœ‰çš„ä½¿ç”¨æ–¹å¼ç„¡éœ€ä¿®æ”¹

### 4. å¯æ¸¬è©¦æ€§ (Testability)
- æ¯å€‹å±¤æ¬¡å¯ç¨ç«‹æ¸¬è©¦
- ä¾è³´æ³¨å…¥ä¾¿æ–¼ mock

### 5. å¯æ“´å±•æ€§ (Extensibility)
- æ–°çš„å‚³è¼¸å±¤å¯ç¹¼æ‰¿ `BaseMCPServer`
- æ–°çš„æ•¸æ“šåº«å¯å¯¦ç¾ `DatabaseConnector` æ¥å£

## ğŸ“Š æ”¹é€²æŒ‡æ¨™

### ä»£ç¢¼è³ªé‡
- âœ… æ¶ˆé™¤ä»£ç¢¼é‡è¤‡
- âœ… çµ±ä¸€éŒ¯èª¤è™•ç†
- âœ… çµ±ä¸€ä¾è³´æ³¨å…¥
- âœ… æ¸…æ™°çš„åˆ†å±¤çµæ§‹

### å¯ç¶­è­·æ€§
- âœ… æ˜ç¢ºçš„è·è²¬åŠƒåˆ†
- âœ… æ¸›å°‘è€¦åˆåº¦
- âœ… æé«˜å…§èšæ€§

### åŠŸèƒ½æ”¹é€²
- âœ… Schema å¿«å–ä¾†æºè¿½è¹¤
- âœ… é è¼‰ç‹€æ…‹é€æ˜åŒ–
- âœ… ç™½åå–®é©—è­‰
- âœ… SSE ç«¯é» CORS æ”¯æŒ
- âœ… å„ªé›…é—œé–‰è™•ç†

## ğŸš€ æœªä¾†è¨ˆåŠƒ

### Stage 4: æ¸¬è©¦
- [x] å–®å…ƒæ¸¬è©¦ï¼ˆå„å±¤ç¨ç«‹æ¸¬è©¦ï¼‰- âœ… **å·²å®Œæˆ** (2025-12-30)
  - âœ… 101 å€‹å–®å…ƒæ¸¬è©¦ï¼Œ100% é€šéç‡
  - âœ… SQL å®‰å…¨é©—è­‰æ¸¬è©¦ï¼š50 å€‹æ¸¬è©¦ï¼Œ96% è¦†è“‹ç‡
  - âœ… Schema å¿«å–ç³»çµ±æ¸¬è©¦ï¼š29 å€‹æ¸¬è©¦ï¼Œ60% è¦†è“‹ç‡
  - âœ… ç•°æ­¥è³‡æ–™åº«ç®¡ç†æ¸¬è©¦ï¼š22 å€‹æ¸¬è©¦ï¼Œ91% è¦†è“‹ç‡
  - âœ… è©³è¦‹ [TESTING_SUMMARY.md](../../TESTING_SUMMARY.md)
- [ ] é›†æˆæ¸¬è©¦ï¼ˆç«¯åˆ°ç«¯æ¸¬è©¦ï¼‰- 28 å€‹ API æ¸¬è©¦å·²å‰µå»ºï¼Œå¾…å•Ÿç”¨
- [ ] æ€§èƒ½æ¸¬è©¦

### å„ªåŒ–å»ºè­°
- [ ] å¯¦ç¾é€£æ¥æ± 
- [ ] æ·»åŠ èªè­‰æˆæ¬Š
- [ ] æ·»åŠ æŸ¥è©¢é™æµ
- [ ] å®Œå–„ç›£æ§å’Œæ—¥èªŒ

## ğŸ“ é·ç§»æŒ‡å—

### å°æ–¼ç¾æœ‰ç”¨æˆ¶

**STDIO æ¨¡å¼ï¼ˆç„¡éœ€ä¿®æ”¹ï¼‰**:
```bash
# èˆŠæ–¹å¼ä»ç„¶å¯ç”¨
python server.py

# æ–°æ–¹å¼
python main.py  # é»˜èª STDIO æ¨¡å¼
```

**HTTP æ¨¡å¼ï¼ˆç„¡éœ€ä¿®æ”¹ï¼‰**:
```bash
# èˆŠæ–¹å¼ä»ç„¶å¯ç”¨
python http_server.py

# æ–°æ–¹å¼
python main.py --http
python main.py --http --host 0.0.0.0 --port 8000
```

### å°æ–¼é–‹ç™¼è€…

**å°å…¥è®Šæ›´**:
```python
# èˆŠæ–¹å¼ï¼ˆä»ç„¶å¯ç”¨ï¼‰
from server import POSDB_TOOLS, handle_call_tool

# æ–°æ–¹å¼ï¼ˆæ¨è–¦ï¼‰
from tools import get_all_tools, handle_tool_call
from core.config import AppConfig, DatabaseConfig
from core.dependencies import get_database_manager
from core.error_handling import format_error_response, ErrorFormat
```

## ğŸ”— ç›¸é—œæ–‡æª”

- [CHANGELOG.md](../../CHANGELOG.md) - å®Œæ•´çš„ç‰ˆæœ¬è®Šæ›´è¨˜éŒ„
- [README.md](../../README.md) - é …ç›®èªªæ˜
- [architecture.md](../architecture.md) - åŸå§‹æ¶æ§‹æ–‡æª”

---

**ç‰ˆæœ¬**: v4.2.0
**æ—¥æœŸ**: 2025-12-10
**ä½œè€…**: Architecture Refactoring Team
